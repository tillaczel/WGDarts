<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        /* Added CSS styles for larger buttons */
        .action-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .action-buttons button {
            font-size: 18px;
            padding: 10px 20px;
        }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
         body {
            background-color: #2c3e50; /* Darker background color matching graph's background */
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
    <script>
        function toggleFinishButton(button) {
            var playerId = button.getAttribute('data-player-id');
            var finishButton = document.getElementById('finish-button-' + playerId);
            var finishPosition = document.getElementById('finish-position-' + playerId);
            var finishedCount = 1;

            if (finishButton.innerText === 'Finished') {
                finishButton.innerText = '';  // Set the finishing position as needed

                {% for other_player in players %}
                    if ({{ other_player.id }} !== playerId) {
                        var otherFinishButton = document.getElementById('finish-button-' + {{ other_player.id }});

                        if (otherFinishButton.style.display === 'none') {
                            finishedCount++;
                        }
                    }
                {% endfor %}

                finishPosition.innerText = finishedCount + getOrdinalSuffix(finishedCount);
            }

            // Hide the button when it is pressed
            finishButton.style.display = 'none';
        }

        function recordResults() {
            // Find the form element by its ID
            var form = document.getElementById('record-game-form');

            // var formData = new FormData();
            {% for player in players %}
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'playerId';
                input.value = "{{ player.id }}";
                form.appendChild(input);

                var input = document.createElement('input');
                var finishPosition = document.getElementById('finish-position-{{ player.id }}');
                input.type = 'hidden';
                input.name = 'finishPosition';
                input.value = finishPosition.innerText;
                form.appendChild(input);
            {% endfor %}
            form.submit()
        }

        function getOrdinalSuffix(number) {
            if (number === 11 || number === 12 || number === 13) {
                return 'th';
            }
            var lastDigit = number % 10;
            switch (lastDigit) {
                case 1:
                    return 'st';
                case 2:
                    return 'nd';
                case 3:
                    return 'rd';
                default:
                    return 'th';
            }
        }

        function clearResults() {
            // Show all finish buttons
            {% for player in players %}
                var finishButton = document.getElementById('finish-button-{{ player.id }}');
                finishButton.style.display = 'inline-block';
                finishButton.innerText = 'Finished'; // Reset button text

                var finishPosition = document.getElementById('finish-position-{{ player.id }}');
                finishPosition.innerText = ''; // Clear finish position
            {% endfor %}
        }
    </script>
</head>
<body>
    <h1>Game On!</h1>
    <div class="game-container">
        {% for player in players %}
            <div class="player-card">
                <h4 class="finish-position" id="finish-position-{{ player.id }}"></h4> <!-- Added line -->
                <img src="{{ url_for('static', filename='uploads/' + player.img_path) }}" alt="{{ player.name }}" class="player-image">
                <h3 class="player-name">{{ player.name }}</h3>
                <h3 class="player-rating">{{ player.rounded_rating }}</h3>
                <button id="finish-button-{{ player.id }}" data-player-id="{{ player.id }}" onclick="toggleFinishButton(this)">Finished</button>
            </div>
            {% if not loop.last %}
                <img src="{{ url_for('static', filename='uploads/vs.png') }}" alt="VS" class="versus-image">
            {% endif %}
        {% endfor %}
    </div>

    <div class="action-buttons" style="margin-top: 60px;">
        <button type="button" onclick="clearResults()">Clear Results</button>
        <div style="margin-top: 20px;"></div>
        <form id="record-game-form" action="{{ url_for('record_results') }}" method="post" enctype="multipart/form-data">
            <!-- Add hidden input fields to pass playerId and finishPosition -->
            {% for player in players %}
                <input type="hidden">
            {% endfor %}
             <button id="record-results-button" type="button" onclick="recordResults()">Submit Results</button>
        </form>

    </div>
</body>
</html>
